// TEST - Copie dans la console :
(async()=>{const T=120,c=[];let s=0,f=0;const cfg={apiKey:"AIzaSyAkKF3xTGTvyzcJbFfpaRT6_yZIjo6bH3U",authDomain:"sky-stack-duel.firebaseapp.com",databaseURL:"https://sky-stack-duel-default-rtdb.europe-west1.firebasedatabase.app",projectId:"sky-stack-duel",storageBucket:"sky-stack-duel.firebasestorage.app",messagingSenderId:"771461430896",appId:"1:771461430896:web:77841ab805a22b9499feb5"};console.log('%cðŸ”¥ TEST FIREBASE - '+T+' connexions','font-size:18px;color:#ff6b00;font-weight:bold');if(typeof firebase==='undefined'){const l=s=>new Promise((r,e)=>{const x=document.createElement('script');x.src=s;if(x.readyState){x.onreadystatechange=()=>{if(x.readyState==='loaded'||x.readyState==='complete'){x.onreadystatechange=null;r()}}}else{x.onload=r}x.onerror=e;document.head.appendChild(x)});await l('https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js');await l('https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js')}async function create(i){try{const a=firebase.initializeApp(cfg,`test-${i}-${Date.now()}`),d=a.database(),r=d.ref(`test/c${i}`);await r.set({t:Date.now(),i,connected:true});r.on('value',()=>{});s++;console.log(`%câœ“ ${i+1}/${T}`,'color:#0c0');return{i,a,r}}catch(e){f++;console.log(`%câœ— ${i+1}/${T}: ${e.message}`,'color:#c00');return{i,e:e.message}}}const st=Date.now();for(let i=0;i<T;i+=10){const b=[];for(let j=i;j<Math.min(i+10,T);j++)b.push(create(j));c.push(...await Promise.allSettled(b));await new Promise(r=>setTimeout(r,100))}const dur=((Date.now()-st)/1000).toFixed(2);console.log('\n\n%cðŸ“Š OK: '+s+'/'+T+' | âœ— FAIL: '+f+'/'+T+' | â± '+dur+'s','font-size:16px;font-weight:bold;color:'+(s>=100?'#0c0':s>=50?'#f90':'#c00'));if(s>=100)console.log('%cðŸš€ Plan BLAZE dÃ©tectÃ©','color:#0c0;font-weight:bold');else if(s>=50)console.log('%câš ï¸ Plan SPARK (gratuit)','color:#f90;font-weight:bold');else console.log('%câš ï¸ ProblÃ¨me dÃ©tectÃ©','color:#c00;font-weight:bold');console.log('\n%câ–¸ Pour nettoyer: cleanFB()','color:#666;font-size:12px');window.cleanFB=async()=>{console.log('%cðŸ§¹ Nettoyage...','color:#06c');let n=0;for(const x of c)if(x.value?.a){try{x.value.r.off();await x.value.a.delete();n++}catch(e){}}if(firebase.apps.length>0){const app=firebase.apps[0],db=app.database();await db.ref('test').remove()}console.log(`%câœ… ${n} connexions fermÃ©es et DB nettoyÃ©e`,'color:#0c0;font-weight:bold')}})()
